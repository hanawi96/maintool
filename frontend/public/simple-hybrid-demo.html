<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Hybrid System Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: white;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        
        .upload-area.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #2563eb;
        }
        
        .waveform-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .waveform-canvas {
            width: 100%;
            height: 200px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .stat-title {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #64748b;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .badge-success {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1d4ed8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Simple Hybrid Waveform System</h1>
        <p>Worker + OffscreenCanvas + Smart Cache Demo</p>
    </div>
    
    <!-- File Upload -->
    <div class="upload-area" id="uploadArea">
        <div style="font-size: 48px; margin-bottom: 20px;">üéµ</div>
        <p style="margin-bottom: 20px; color: #64748b;">
            Drop an audio file here or click to select
        </p>
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
            Choose Audio File
        </button>
        <input type="file" id="fileInput" class="file-input" accept="audio/*">
    </div>
    
    <!-- Waveform Display -->
    <div class="waveform-container" id="waveformContainer" style="display: none;">
        <h3>Waveform Visualization</h3>
        <canvas class="waveform-canvas" id="waveformCanvas" width="800" height="200"></canvas>
        
        <div id="waveformInfo" class="info-panel" style="display: none;">
            <!-- Info will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- Loading State -->
    <div class="loading" id="loadingState" style="display: none;">
        <div style="font-size: 32px; margin-bottom: 15px;">‚è≥</div>
        <h3>Processing Audio File...</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <p id="progressText">0% complete</p>
    </div>
    
    <!-- Performance Stats -->
    <div class="stats" id="statsContainer" style="display: none;">
        <div class="stat-card">
            <div class="stat-title">Processing Time</div>
            <div class="stat-value" id="processingTime">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Strategy</div>
            <div class="stat-value" id="strategy">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Cache Status</div>
            <div class="stat-value" id="cacheStatus">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Data Points</div>
            <div class="stat-value" id="dataPoints">--</div>
        </div>
    </div>

    <script type="module">
        // Simple demo implementation (would normally use the actual hybrid service)
        class SimpleDemo {
            constructor() {
                this.isProcessing = false;
                this.currentFile = null;
                this.setupEventListeners();
            }

            setupEventListeners() {
                const fileInput = document.getElementById('fileInput');
                const uploadArea = document.getElementById('uploadArea');

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.processFile(e.target.files[0]);
                    }
                });

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        this.processFile(e.dataTransfer.files[0]);
                    }
                });
            }

            async processFile(file) {
                if (this.isProcessing) return;
                
                this.isProcessing = true;
                this.currentFile = file;
                
                console.log('üéµ Processing file:', file.name);
                
                // Show loading state
                this.showLoading();
                
                try {
                    // Simulate processing with progress
                    const result = await this.simulateProcessing(file);
                    
                    // Show result
                    this.showResult(result);
                    
                } catch (error) {
                    console.error('‚ùå Processing failed:', error);
                    alert('Processing failed: ' + error.message);
                } finally {
                    this.isProcessing = false;
                }
            }

            showLoading() {
                document.getElementById('uploadArea').style.display = 'none';
                document.getElementById('waveformContainer').style.display = 'none';
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('loadingState').style.display = 'block';
            }

            async simulateProcessing(file) {
                // Simulate processing steps with progress
                const steps = [
                    { label: 'Reading file...', duration: 300 },
                    { label: 'Decoding audio...', duration: 500 },
                    { label: 'Processing waveform...', duration: 700 },
                    { label: 'Rendering visualization...', duration: 400 },
                    { label: 'Optimizing cache...', duration: 200 }
                ];

                let totalProgress = 0;
                const stepSize = 100 / steps.length;

                for (let i = 0; i < steps.length; i++) {
                    const step = steps[i];
                    document.getElementById('progressText').textContent = step.label;
                    
                    await new Promise(resolve => setTimeout(resolve, step.duration));
                    
                    totalProgress += stepSize;
                    document.getElementById('progressFill').style.width = totalProgress + '%';
                }

                // Generate mock waveform data
                const waveformData = this.generateMockWaveform(800);
                
                return {
                    data: waveformData,
                    duration: 120.5, // Mock duration
                    processingTime: steps.reduce((sum, step) => sum + step.duration, 0),
                    strategy: typeof Worker !== 'undefined' ? 'Web Worker' : 'Main Thread',
                    fromCache: Math.random() > 0.7, // 30% cache hit simulation
                    dataPoints: waveformData.length
                };
            }

            generateMockWaveform(samples) {
                const data = [];
                for (let i = 0; i < samples; i++) {
                    // Generate realistic waveform pattern
                    const time = (i / samples) * 10; // 10 second simulation
                    const frequency = 0.5 + Math.sin(time * 0.3) * 0.3;
                    const amplitude = Math.sin(time * frequency) * Math.exp(-Math.abs(time - 5) * 0.1);
                    data.push(Math.abs(amplitude) * (0.5 + Math.random() * 0.5));
                }
                return data;
            }

            showResult(result) {
                // Hide loading
                document.getElementById('loadingState').style.display = 'none';
                
                // Show waveform
                document.getElementById('waveformContainer').style.display = 'block';
                document.getElementById('statsContainer').style.display = 'grid';
                
                // Draw waveform
                this.drawWaveform(result.data);
                
                // Update stats
                document.getElementById('processingTime').textContent = result.processingTime + 'ms';
                document.getElementById('strategy').textContent = result.strategy;
                document.getElementById('cacheStatus').textContent = result.fromCache ? '‚ö° Hit' : 'üîÑ Miss';
                document.getElementById('dataPoints').textContent = result.dataPoints;
                
                // Show info
                const infoPanel = document.getElementById('waveformInfo');
                infoPanel.style.display = 'block';
                infoPanel.innerHTML = `
                    <h4>Processing Results</h4>
                    <p>
                        <span class="badge ${result.fromCache ? 'badge-success' : 'badge-info'}">
                            ${result.fromCache ? '‚ö° Cached' : 'üîÑ Processed'}
                        </span>
                        <span class="badge badge-info">
                            ${result.strategy}
                        </span>
                    </p>
                    <p><strong>File:</strong> ${this.currentFile.name}</p>
                    <p><strong>Duration:</strong> ${result.duration}s</p>
                    <p><strong>Processing Time:</strong> ${result.processingTime}ms</p>
                    <p><strong>Data Points:</strong> ${result.dataPoints}</p>
                    
                    <div class="controls">
                        <button class="btn btn-primary" onclick="demo.processFile(demo.currentFile)">
                            üîÑ Process Again
                        </button>
                        <button class="btn btn-secondary" onclick="location.reload()">
                            üßπ Reset Demo
                        </button>
                    </div>
                `;
                
                console.log('‚úÖ Processing complete:', result);
            }

            drawWaveform(data) {
                const canvas = document.getElementById('waveformCanvas');
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set up drawing
                const centerY = canvas.height / 2;
                const barWidth = canvas.width / data.length;
                const maxBarHeight = canvas.height * 0.8;
                
                // Draw background gradient
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.1)');
                gradient.addColorStop(1, 'rgba(139, 92, 246, 0.1)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw waveform bars
                ctx.fillStyle = '#3b82f6';
                for (let i = 0; i < data.length; i++) {
                    const amplitude = data[i];
                    const barHeight = amplitude * maxBarHeight;
                    const x = i * barWidth;
                    const y = centerY - barHeight / 2;
                    
                    ctx.fillRect(x, y, Math.max(1, barWidth - 1), barHeight);
                }
                
                // Add center line
                ctx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(canvas.width, centerY);
                ctx.stroke();
            }
        }

        // Initialize demo
        const demo = new SimpleDemo();
        window.demo = demo; // Make it global for button access
        
        console.log('üöÄ Simple Hybrid Demo Ready');
        console.log('üìä System Capabilities:', {
            webWorkers: typeof Worker !== 'undefined',
            offscreenCanvas: typeof OffscreenCanvas !== 'undefined',
            indexedDB: typeof indexedDB !== 'undefined',
            audioContext: typeof AudioContext !== 'undefined'
        });
    </script>
</body>
</html>
